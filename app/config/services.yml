# Learn more about services, parameters and containers at
# http://symfony.com/doc/current/book/service_container.html
parameters:
     sonata.media.admin.gallery_has_media.class: AppBundle\Admin\GalleryHasMediaAdmin
     my_user_provider.class: AppBundle\Security\Core\User\OAuthUserProvider

services:
    app.event_listener.serializer_subscriber:
        class: AppBundle\EventListener\SerializerSubscriber
        arguments: ["@sonata.media.controller.api.media", "@router"]
        tags:
            - { name: jms_serializer.event_subscriber }

    app.twig_extension:
        class: AppBundle\Twig\AppExtension
        public: false
        arguments: ["@doctrine"]
        tags:
            - { name: twig.extension }

    monitor.check.travis_check:
        class: AppBundle\Check\TravisCheck
        arguments:
            - "geekhub-php"
            - "CheTheatre"
            - "master"
        tags:
            - { name: liip_monitor.check, alias: monitor_travis }

    two_performance_events_per_day_validator:
        class: AppBundle\Validator\TwoPerformanceEventsPerDayValidator
        arguments:
            - "@=service('doctrine.orm.default_entity_manager').getRepository('AppBundle:PerformanceEvent')"
            - "@translator"
        tags:
            - { name: validator.constraint_validator, alias: two_performance_events_per_day }

    min_size_slider_image_validator:
        class: AppBundle\Validator\MinSizeSliderImageValidator
        arguments: ["@translator"]
        tags:
            - { name: validator.constraint_validator, alias: min_size_slider_image }

    app.event.entity_delete:
        class: AppBundle\EventListener\EntityDeleteListener
        arguments:
            - "@security.token_storage"
        tags:
            - { name: doctrine.event_listener, event: preSoftDelete, connection: default }

    api_key_authenticator:
        class:  AppBundle\Security\ApiKeyAuthenticator
        public: false
        arguments: ["@doctrine", "@logger"]
        tags:
           - { name: monolog.logger, channel: security_error }

    user_login:
        class: AppBundle\Services\UserLogin
        arguments: ["@doctrine", "@serializer", "@validator", "@facebook_user_provider"]

    facebook_user_provider:
        class: AppBundle\Services\FacebookUserProvider
        arguments: ["@serializer", "@validator"]

    app.exception_listener:
        class: AppBundle\EventListener\ExceptionListener
        tags:
            - { name: kernel.event_listener, event: kernel.exception }

    app.ip_client_listener:
        class: AppBundle\EventListener\IpClientListener
        arguments: ["@doctrine"]
        tags:
            - { name: kernel.event_listener, event: kernel.request, priority: 255 }

    customer_app.monolog_web_processor:
         class: Monolog\Processor\WebProcessor
         tags:
            - { name: monolog.processor, channel: security_error }
